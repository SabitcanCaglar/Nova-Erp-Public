@{ int? kullanıcıId = Context.Session.GetInt32("Id");}
@{ string kullanıcıadsoyad = Context.Session.GetString("AdSoyad");}


@{
    Layout = null;
}


<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>TASLAK SİPARİŞLER</title>

    
</head>
<body>
    <button class="btn btn-danger" id="SiparisTaslakHubBtn" style="visibility: hidden"></button>
    @*<div class="page-header card">
            <div class="row align-items-end">
                <div class="col-lg-8">

                    <div class="page-header-title">
                        <i class=" icofont icofont-tasks icofont-3x" style="background-color:#ff7814"></i>
                        <div class="d-inline">
                            <h4>Taslak Siparişler</h4>
                            <span>Taslak Siparişlerinizi Size Özel Görüntüleyebilir ve İşlemler yapabilirsiniz..</span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="page-header-breadcrumb">
                        <ul class="breadcrumb-title">
                            <li class="breadcrumb-item">
                                <a href="/Anasayfa">
                                    <i class="icofont icofont-home"></i>
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="#!">Siparis</a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="/TaslakSiparisler">Taslak Siparişler</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>*@
    <div class="row heading-bg" style="background-color: #2c466b; text-align: center">
        <div class="col-lg-5 col-md-4 col-sm-4 col-xs-12">
            <h2 class="txt-light"> <i class="fa fa-tasks"></i>&nbspTaslak Siparişler</h2>
        </div>
        <!-- Breadcrumb -->
        <div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">

        </div>
        <!-- /Breadcrumb -->
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-default card-view">
                <div class="panel-heading">
                    <div class="pull-center">

                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="panel-wrapper collapse in">
                    <div class="panel-body">
                        <h1 id="yazı" style="color: #2c466b; text-align: center">@kullanıcıadsoyad </h1><br />
                        <h3 id="yazı" style="color: #2c466b; text-align: center">Kullanıcısının Son 1 Ay Sipariş Verileri</h3><br />
                        <div id="personelsonay" style="width:100%; height: 600px"></div>


                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-default card-view">
                <div class="panel-heading">
                    <div class="pull-center">

                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="panel-wrapper collapse in">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-2" >


                            </div>
                            <div class="col-md-3">
                                <button id="taslaksiparis" style=" font-size: 20px " class="btn btn-warning btn-anim"><i class="fa fa-check-square fa-3x"></i><span class="btn-text">Taslak Sipariş&nbsp&nbsp</span><span id="taslaksiparisbadge" style="color: #c9222a;font-size:15px" class="badge badge-light">4</span></button>

                            </div>
                            <div class="col-md-3">

                                <button id="planlamaonaylı" style=" font-size: 20px " class="btn btn-success btn-anim"><i class="fa fa-check-square fa-3x"></i><span class="btn-text">Planlama Onay&nbsp&nbsp</span><span id="planlamaonaybadge" style="color: #c9222a;font-size:15px" class="badge badge-light">4</span></button>
                            </div>
                            <div class="col-ms-1">


                            </div>
                            <div class="col-md-3">

                                <button id="revizetalep" style=" font-size: 20px " class="btn btn-primary btn-anim"><i class="fa fa-ban fa-3x"></i><span class="btn-text">Revize Talep&nbsp&nbsp</span><span id="revizetalepbadge" style="color: #c9222a;font-size:15px" class="badge badge-light">2</span></button>
                            </div>

                        </div><br /><br /><br /><br />

                        <div id="listeload">
                            <h1 id="yazı" style="color: #2c466b; text-align: center">Taslak Sipariş Listesi</h1>

                            <table id="taslaksiparisler" class="table table-border-style wrap">


                                <thead class="wrap">
                                    <tr>
                                        <th>Id</th>
                                        <th>GüncelleyenpersonelId</th>
                                        <th>EklenmeTarihi</th>
                                        <th>Aciklama</th>
                                        <th style="text-align:center">PO NUMBER</th>
                                        <th style="text-align:center">Sipariş Kodu</th>
                                        <th style="text-align:center">Miktar</th>
                                        <th style="text-align:center">Fiyat</th>
                                        <th style="text-align:center">Müşteri <br /> Adı-Soyadı</th>
                                        <th style="text-align:center">Oluşturma<br />Tarihi</th>
                                        <th style="text-align:center">Ayrıntı</th>
                                        <th style="text-align:center">Sil</th>


                                    </tr>
                                </thead>
                            </table>


                        </div>



                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        $(document).ready(function () {
            var MüsteriId = $("#müsteriId").val();
            $.ajax({
                type: "GET",
                url: "/TaslakSiparis/PersonelSonAy",
                dataType: 'json',

                success: function (data) {


                    chart.load(data);

                }






            });





        });

        var chart = {

            load: function (data) {


                am4core.ready(function () {

                    // Themes begin
                    am4core.useTheme(am4themes_kelly);
                    am4core.useTheme(am4themes_animated);
                    // Themes end

                    // Create chart instance
                    var chart = am4core.create("personelsonay", am4charts.PieChart);
                    chart.startAngle = 160;
                    chart.endAngle = 380;

                    // Let's cut a hole in our Pie chart the size of 40% the radius
                    chart.innerRadius = am4core.percent(40);

                    // Add data
                    chart.data = data;

                    // Add and configure Series
                    var pieSeries = chart.series.push(new am4charts.PieSeries());
                    pieSeries.dataFields.value = "miktar";
                    pieSeries.dataFields.category = "urunKodu";
                    pieSeries.slices.template.stroke = new am4core.InterfaceColorSet().getFor("background");
                    pieSeries.slices.template.strokeWidth = 1;
                    pieSeries.slices.template.strokeOpacity = 1;

                    // Disabling labels and ticks on inner circle
                    pieSeries.labels.template.disabled = true;
                    pieSeries.ticks.template.disabled = true;

                    // Disable sliding out of slices
                    pieSeries.slices.template.states.getKey("hover").properties.shiftRadius = 0;
                    pieSeries.slices.template.states.getKey("hover").properties.scale = 1;
                    pieSeries.radius = am4core.percent(40);
                    pieSeries.innerRadius = am4core.percent(30);

                    var cs = pieSeries.colors;
                    cs.list = [am4core.color(new am4core.ColorSet().getIndex(0))];

                    cs.stepOptions = {
                        lightness: -0.05,
                        hue: 0
                    };
                    cs.wrap = false;


                    // Add second series
                    var pieSeries2 = chart.series.push(new am4charts.PieSeries());
                    pieSeries2.dataFields.value = "miktar";
                    pieSeries2.dataFields.category = "urunKodu";
                    pieSeries2.slices.template.stroke = new am4core.InterfaceColorSet().getFor("background");
                    pieSeries2.slices.template.strokeWidth = 1;
                    pieSeries2.slices.template.strokeOpacity = 1;
                    pieSeries2.slices.template.states.getKey("hover").properties.shiftRadius = 0.05;
                    pieSeries2.slices.template.states.getKey("hover").properties.scale = 1;

                    pieSeries2.labels.template.disabled = true;
                    pieSeries2.ticks.template.disabled = true;


                    var label = chart.seriesContainer.createChild(am4core.Label);
                    label.textAlign = "middle";
                    label.horizontalCenter = "middle";
                    label.verticalCenter = "middle";
                    label.adapter.add("text", function (text, target) {
                        return "[font-size:18px]Total[/]:\n[bold font-size:35px]" + pieSeries.dataItem.values.value.sum + "[/]";
                    })

                }); // end am4core.ready()



                $('g:has(> g[stroke="#3cabff"])').hide();


            }


        };

        var siparistaslak;
        var taslaksiparisler;
        $(document).ready(function () {

            taslaksiparisler = $('#taslaksiparisler').DataTable({

                /*"dom": 'Blfrtip',*/

                "responsive": true, "lengthChange": false,
                "autoWidth": false, "processing": true,
                "serverSide": false, "select": false,
                "destroy": true,
                "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                "fixedHeader": true,
                "scrollX": true,
                "scrollY": true,
                "order": [[2, "desc"]],

                "ajax": {
                    "url": "/TaslakSiparis/TaslakSiparisListe",
                    "type": "GET"
                },
                "columnDefs":
                    [
                        {
                            "targets": [0, 1, 2, 3],
                            "visible": false,
                            "searchable": false,
                        },
                        {
                            "targets": [2, 3, 4, 5, 6, 7, 8, 9],
                            "className": 'dt-body-center'

                        },



                    ],







                "columns": [




                    { "data": "id" },
                    { "data": "guncelleyenPersonelId" },
                    { "data": "eklenmeTarihi" },
                    { "data": "aciklama" },
                    { "data": "poNumber" },
                    { "data": "siparisKodu" },
                    { "data": "miktar" },
                    {
                        "data": "fiyat",
                        "render": function (fiyat) {
                            return '$' + fiyat;

                        }

                    },
                    { "data": "musteriAdiSoyadi" },
                    { "data": "olusturmaTarihi" },






                    {
                        "data": null,
                        "className": "ayrinti",
                        "render": function (data, type, row) {

                            return '  <button id="' + data.siparisKodu + '" class="btn btn-primary btn-icon-anim btn-circle"><i class="fa fa-info-circle "></i></button>  ';
                        },
                        "targets": -1
                    },
                    {
                        "data": null,
                        "className": "sil",
                        "render": function (data, type, row) {

                            return ' <button class="btn btn-danger btn-icon-anim btn-circle"><i class="fa fa-trash "></i></button> ';
                        },
                        "targets": -1
                    }


                ],


            });
            $('#taslaksiparisler tbody').on('click', '.ayrinti', function () {
                siparistaslak = taslaksiparisler.row(this).data();
                SiparisAyrinti(siparistaslak);




            });
            $('#taslaksiparisler tbody').on('click', '.sil', function () {
                var data = taslaksiparisler.row(this).data();


                TaslakSiparisSil(data);

            });



        });

        function SiparisAyrinti(siparistaslak) {
            $.ajax({
                type: "POST",
                url: "/TaslakSiparis/SiparisUrunListe",
                data: siparistaslak,
                dataType: 'json',
                success: function (data) {


                    siparisayrinti.planlamaonaysızmodal(siparistaslak);
                    siparisayrinti.eklenenürünlerigetir(data);


                }


            });
        }




        var siparisayrinti = {

            eklenenürünlerigetir: function (data) {

                var siparisürüntablo = $('#siparisuruntablo').DataTable({

                    /*"dom": 'Blfrtip',*/

                    "responsive": true, "lengthChange": false,
                    "autoWidth": false, "processing": true,
                    "serverSide": false, "select": false,
                    "destroy": true,
                    "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                    "fixedHeader": true,
                    "scrollX": true,
                    "scrollY": true,

                    "data": data,
                    "columnDefs":
                        [
                            {
                                "targets": [0, 1, 2, 5, 6, 12, 13],
                                "visible": false,
                                "searchable": false,
                            },
                            {
                                "targets": [3, 4, 7, 8, 9, 10, 11, 14],
                                "className": 'dt-center'

                            },





                        ],







                    "columns": [




                        { "data": "id" },
                        { "data": "guncelleyenPersonelId" },

                        { "data": "urunId" },
                        { "data": "kodu" },
                        { "data": "adi" },
                        {
                            "data": "satisFiyat",
                            "render": function (satisFiyat) {
                                return '$' + satisFiyat;

                            }

                        },
                        { "data": "stokAdet" },
                        { "data": "renkKod" },
                        { "data": "kategori" },
                        { "data": "altKategori" },
                        { "data": "miktar" },
                        { "data": "birim" },
                        { "data": "siparisKodu" },
                        { "data": "siparisTaslakId" },


                        {
                            "data": null,
                            "className": "düzenle",
                            "render": function (data, type, row) {

                                return '<button class="btn btn-primary btn-icon-anim btn-circle"><i class="fa fa-edit "></i></button> ';
                            },
                            "targets": -1
                        },
                        {
                            "data": null,
                            "className": "sil",
                            "render": function (data, type, row) {

                                return ' <button class="btn btn-danger btn-icon-anim btn-circle"><i class="fa fa-trash "></i></button> ';
                            },
                            "targets": -1
                        }


                    ]


                });
                $('#siparisuruntablo tbody').on('click', '.düzenle', function () {
                    var data = siparisürüntablo.row(this).data();


                    SiparisOnayUrunGunncelle(data);

                });
                $('#siparisuruntablo tbody').on('click', '.sil', function () {
                    var data = siparisürüntablo.row(this).data();


                    SiparisOnayUrunSil(data);

                });
            },
            planlamaonaysızmodal: function (siparistaslak) {

                var poNumber;
                var aciklama;
                if (siparistaslak.poNumber == undefined || siparistaslak.poNumber == null) {
                    poNumber = "";
                }
                else {
                    poNumber = siparistaslak.poNumber;
                };
                if (siparistaslak.aciklama == undefined || siparistaslak.aciklama == null) {
                    aciklama = "";

                }
                else {
                    aciklama = siparistaslak.aciklama;
                };





                Swal.fire({
                    title: '<i  class="fa fa-info fa-3x" style="color:#3cb878">' +
                        '<h2 style="color:#2c466b">SİPARİŞ AYRINTI</h2>',
                    allowOutsideClick: false,
                    html: true,


                    cancelButtonColor: '#c9222a',
                    cancelButtonText: 'Vazgeç',
                    showCancelButton: true,
                    confirmButtonText: 'Onayla',
                    confirmButtonColor: '#2c466b',
                    showLoaderOnConfirm: true,



                    width: '1550px',
                    html:

                        '<div  class="col-sm-12">' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Taslak Sipariş Kodu :&nbsp&nbsp</label>' +
                        '<label class="col-form-label" style="font-size:25px;color:#c9222a">' + siparistaslak.siparisKodu + '</label><br /><br />' +
                        '<label class="col-form-label" style="font-size:20px;color:#2c466b">PO NUMBER &nbsp&nbsp</label>' +

                        '<input id="ponumber" value="' + poNumber + '" class="col-form-control" style="font-size:20px;color:#c9222a"></input>' +

                        '</div>' +



                        '<div  class="col-sm-12">' +


                        '<table id="siparisuruntablo" class="table table-border-style wrap">' +
                        ' <thead class="wrap">' +
                        '<tr>' +
                        '<th>Id</th>' +
                        '<th>GüncelleyenpersonelId</th>' +
                        '<th>ÜrünId</th>' +
                        '<th style="text-align:center">Ürün Kodu</th>' +
                        '<th style="text-align:center">Ürün Adı</th>' +
                        '<th style="text-align:center">Satış Fiyat</th>' +
                        '<th style="text-align:center">Stok Adet</th>' +
                        '<th style="text-align:center">Renk Kodu</th>' +
                        '<th style="text-align:center">Kategori</th>' +
                        '<th style="text-align:center">Alt <br /> Kategori</th>' +
                        '<th style="align-items:center">Miktar</th>' +
                        '<th style="align-items:center">Birim</th>' +
                        '<th style="align-items:center">SiparisKodu</th>' +
                        '<th style="align-items:center">SiparisTaslakId</th>' +
                        '<th style="align-items:center">Düzenle</th>' +
                        '<th style="align-items:center">Sil</th>' +

                        '</tr>' +
                        '</thead>' +
                        '</table>' +
                        '</div><br /><br />' +
                        '<div  class="input-group row g-3 align-items-center col-sm-12">' +
                        '<div  class="col-sm-6">' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Açıklama</label><br />' +
                        '<textarea id="aciklama" style="height:150px;width:605px" rows="8" cols="55" class="col-sm-12 form-control">' + aciklama + '</textarea>' +

                        '</div><br /><br />' +
                        '<div  class="col-sm-6">' +
                        '<button id="siparisayrintiurunekle'+siparistaslak.id+'" onclick="SiparisOnayUrunEkle(siparistaslak)" class="btn btn-success btn-anim"><i class="icon-rocket"></i><span class="btn-text">Ürün Ekle</span></button><br /><br />'+
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Toplam Adet :</label>' +
                        '<label class="col-form-label" style="font-size:45px;color:#c9222a">' + ' ' + '' + siparistaslak.miktar + ' </label><br />' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Toplam Fiyat :</label>' +
                        '<label class="col-form-label" style="font-size:45px;color:#c9222a">' + ' ' + '$' + siparistaslak.fiyat + ' </label>' +


                        '</div>' +
                        '</div><br />',








                    preConfirm: () => {
                        siparistaslak.poNumber = $("#ponumber").val();
                        siparistaslak.aciklama = $("#aciklama").val();
                        $.ajax({
                            type: "POST",
                            url: "/TaslakSiparis/TaslakSiparisGuncelle",
                            data: siparistaslak,
                            dataType: 'json',
                            success: function (data) {
                                if (data == "basarili") {
                                    Swal.mixin({
                                        toast: true,
                                        position: 'top',
                                        iconColor: 'white',
                                        customClass: {
                                            popup: 'colored-toast'
                                        },
                                        showConfirmButton: false,
                                        timer: 3500,
                                        timerProgressBar: true,

                                    }).fire({
                                        icon: 'success',
                                        title: 'Yaptığınız tüm değişiklikler başarılı bir şekilde Üretim Planlama birimine İletildi.',
                                        width: '500px'

                                    })
                                    var message = "Taslak Sipariş Güncellendi.";
                                    $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);

                                } else {
                                    Swal.mixin({
                                        toast: true,
                                        position: 'top',
                                        iconColor: 'white',
                                        customClass: {
                                            popup: 'colored-toast'
                                        },
                                        showConfirmButton: false,
                                        timer: 4000,
                                        timerProgressBar: true,

                                    }).fire({
                                        icon: 'error',
                                        title: data,
                                        width: '500px'

                                    })
                                }
                               

                            }


                        })

                    },
                    allowOutsideClick: () => !Swal.isLoading()
                })

            }
        };

        function SiparisOnayUrunGunncelle(data) {
           
                      
            var toplamfiyat = data.miktar * data.satisFiyat;
            Swal.fire({
                title: "<h2 style='color:#c9222a'>ÜRÜN SİPARİŞTE MEVCUT!</h2>",
                html: true,

                cancelButtonColor: '#c9222a',
                cancelButtonText: 'Vazgeç',
                showCancelButton: true,
                confirmButtonText: 'Onayla',
                confirmButtonColor: '#2c466b',
                showLoaderOnConfirm: true,
                allowOutsideClick: false,
                width: '600px',
                html:



                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                    '<label  class="  col-form-label" style="font-size:20px;float:left">Ürün Kodu</label><br />' +
                    ' <input type="text" style="height:38px;font-size:30px" value="' + data.kodu + '" id="müsteriadi" class="col-sm-8 form-control form-control-center" name="MüsteriAdi"  disabled ><br />' +
                    '</div>' +
                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                    '<label  class=" col-form-label" style="font-size:20px;float:left">Renk Kodu</label><br />' +
                    ' <input type="text" style="height:38px;font-size:30px" value="' + data.renkKod + '" id="müsteriadi" class="col-sm-8 form-control form-control-center" name="MüsteriAdi" disabled ><br />' +
                    '</div>' +
                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                    '<label  class="  col-form-label" style="font-size:20px;float:left">Kategori</label><br />' +
                    ' <input type="text" style="height:38px;font-size:30px" value="' + data.kategori + '" id="müsteriadi" class="col-sm-8 form-control form-control-center" name="MüsteriAdi"  disabled><br />' +
                    '</div>' +
                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                    '<label  class=" col-form-label" style="font-size:20px;float:left">Fiyat</label><br />' +
                    ' <input type="text" style="height:38px;font-size:30px" value="' + '$' + data.satisFiyat + '" id="müsteriadi" class="col-sm-8 form-control form-control-center" name="MüsteriAdi"  disabled ><br /><br />' +
                    '</div><br />' +

                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                    '<div class="col-md-1">' +
                    '</div>' +
                    ' <input type="number" style="width:205px;height:45px;font-size:40px;color:#c9222a" value="' + data.miktar + '" id="copymiktar" class="col-sm-5 form-control form-control-center"  >' +
                    '<div class="col-md-1">' +
                    '</div>' +
                    '<select id="copybirim" style="width:205px;height:45px"  class="form-control col-md-5">' +
                    '<option value ="Adet" >Adet</option >' +
                    '<option value="Kilogram">Kilogram</option>' +
                    '<option value="Metre">Metre</option>' +
                    '<option value="Ton">Ton</option>' +
                    '</select >' +

                    '</div>' +








                    '</div>',





                preConfirm: () => {
                    var std = {

                        Id: data.id,
                        SiparisTaslakId: siparistaslak.id,
                        UrunId: data.urunId,
                        UrunKodu: data.kodu,
                        UrunAdi: data.adi,
                        Miktar: data.miktar,
                        Miktar: $("#copymiktar").val(),
                        Birim: $("#copybirim").val(),
                        SiparisKodu: data.siparisKodu,
                        TaslakOnay: true

                    }
                     $.ajax({
                        type: "POST",
                        url: "/YeniSiparis/UrunGuncelle",
                        data: std,
                        dataType: 'json',
                        success: function (data) {
                            if (data.durum == "basarili") {

                                Swal.fire({
                                    timer: 2000,
                                    showConfirmButton: false,
                                    icon: 'success',
                                    html: true,

                                    html:


                                        '<label class=" col-form-label" style="font-size:50px;color:#2c466b">' + std.UrunKodu + '</label><br />' +
                                        '<label class=" col-form-label" style="font-size:50px;color:#c9222a">' + std.Miktar + ' ' + std.Birim + '</label><br />' +
                                        '<label class=" col-form-label" style="font-size:30px;color:#2c466b">Olarak Başarılı Bir Şekilde Güncellendi..</label><br /><br />'
                                    ,

                                    confirmButtonColor: '#2c466b'

                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })

                                //var test = "Müşteri güncellendi.";
                                //$("#müsterihubbtn").trigger('müsterieklesilgüncelle', [test]);
                                var message = "Ürün Güncellendi.";
                                $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);
                                setTimeout(function () {
                                    if (data.siparistaslak.planlamaRevizeTalepSebebi==null) {
                                        SiparisAyrinti(data.siparistaslak);
                                    }
                                    else {
                                        RevizeAyrinti(data.siparistaslak);
                                    }

                                }, 2000);

                            }



                            else {

                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: data.durum,
                                    confirmButtonColor: '#2c466b',
                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })
                            }

                        }


                    })






                },
                allowOutsideClick: () => !Swal.isLoading()
            })
            
        }
        function SiparisOnayUrunSil(data) {
            var std = {
                Id: data.id,
                SiparisTaslakId: data.siparisTaslakId,
                ÜrünId: data.urunId,
                ÜrünKodu: data.kodu,
                ÜrünAdi: data.adi,
                SiparisKodu: data.siparisKodu,



            }
            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-success btn-round',
                    cancelButton: 'btn btn-danger btn-round',
                },
                focusConfirm: false,
                buttonsStyling: false

            })

            swalWithBootstrapButtons.fire({
                title: 'Emin Misiniz ?',
                text: 'Seçtiğiniz' + ' ' + data.kodu + ' Kodlu Ürün Silinmek Üzere..',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'EVET',
                cancelButtonText: 'HAYIR',


            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: "/YeniSiparis/SiparisOnayUrunSil",
                        data: std,
                        dataType: 'json',
                        success: function (data) {

                            if (data.durum == "basarili") {

                                
                                var message = "Ürün Silme";
                                $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);
                                if (data.siparisTaslak.planlamaRevizeTalepSebebi == null) {
                                    SiparisAyrinti(data.siparisTaslak);
                                }
                                else {
                                    RevizeAyrinti(data.siparisTaslak);
                                }

                            }
                            else {

                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: data.durum,
                                    confirmButtonColor: '#2c466b',
                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })
                            }

                        }


                    })





                }


            })
        }

        function SiparisOnayUrunEkle(siparisTaslak) {
           

            var poNumber;
            var aciklama;
            if (siparistaslak.poNumber == undefined || siparistaslak.poNumber == null) {
                poNumber = "";
            }
            else {
                poNumber = siparistaslak.poNumber;
            };
            if (siparistaslak.aciklama == undefined || siparistaslak.aciklama == null) {
                aciklama = "";

            }
            else {
                aciklama = siparistaslak.aciklama;
            };
            Swal.fire({
                title: '<i  class="fa fa-folder-plus fa-3x" style="color:#3cb878">' +
                    '<h2 style="color:#2c466b">SİPARİŞ ÜRÜN EKLE</h2>',
                allowOutsideClick: false,
                html: true,


                cancelButtonColor: '#c9222a',
                cancelButtonText: 'Vazgeç',
                showCancelButton: true,
                confirmButtonText: 'Onayla',
                confirmButtonColor: '#2c466b',
                showLoaderOnConfirm: true,




                width: '1750px',
                html:

                    '<div  class="col-sm-12">' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Taslak Sipariş Kodu :&nbsp&nbsp</label>' +
                    '<label class="col-form-label" style="font-size:25px;color:#c9222a">' + siparistaslak.siparisKodu + '</label><br /><br />' +
                    '</div>' +



                    '<div  class="col-sm-12">' +


                    '<table id="uruntablo" class="table table-border-style wrap">' +
                    ' <thead class="wrap">' +
                    '<tr>' +
                    '<th>Id</th>' +
                    '<th>GüncelleyenpersonelId</th>' +
                    '<th style="text-align:center">Ürün Kodu</th>' +
                    '<th style="text-align:center">Ürün Adı</th>' +
                    '<th style="text-align:center">Satış Fiyat</th>' +
                    '<th style="text-align:center">Stok Adet</th>' +
                    '<th style="text-align:center">Renk Kodu</th>' +
                    '<th style="text-align:center">Kategori</th>' +
                    '<th style="text-align:center">Alt <br /> Kategori</th>' +
                    '<th style="align-items:center">Miktar</th>' +
                    '<th style="align-items:center">Birim</th>' +
                    '<th style="align-items:center">Sipariş</th>' +

                    '</tr>' +
                    '</thead>' +
                    '</table>' +
                    '</div><br /><br />' ,
                    








                preConfirm: () => {


                    $.ajax({
                        type: "POST",
                        url: "/YeniSiparis/UrunEkle",
                        
                        dataType: 'json',
                        success: function (durum) {

                            if (durum == "basarili") {

                                Swal.fire({
                                    timer: 1500,
                                    showConfirmButton: false,
                                    icon: 'success',
                                    html: true,
                                    width: 550,
                                    html:



                                        '<label class=" col-sm-11 col-form-label" style="font-size:40px;color:#2c466b">Başarılı Bir Şekilde Eklendi ve Üretim Planlama Birimine Yönlendirildi. </label><br /><br />'
                                    ,



                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })

                               

                                
                            }
                            else {

                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: durum,
                                    confirmButtonColor: '#2c466b',
                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })
                            }

                        }


                    })






                },
                allowOutsideClick: () => !Swal.isLoading()
            })
            UrunListeGetir(siparistaslak);
            
        }
        function UrunListeGetir(siparisTaslak) {
            var uruntablo;
            $(document).ready(function () {
                uruntablo = $('#uruntablo').DataTable({

                    "dom": 'Blfrtip',

                    "responsive": true, "lengthChange": false,
                    "autoWidth": false, "processing": true,
                    "serverSide": false, "select": false,
                    "destroy": true,
                    "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                    "fixedHeader": true,
                    "scrollX": true,
                    "scrollY": true,

                    "ajax": {
                        "url": "/YeniSiparis/UrunListesi",
                        "type": "GET"
                    },
                    "columnDefs":
                        [
                            {
                                "targets": [0, 1],
                                "visible": false,
                                "searchable": false,
                            },
                            {
                                "targets": [2, 3, 4, 5, 6, 7, 8, 9, 10],
                                "className": 'dt-body-center'

                            },



                        ],

                    "buttons": [
                        {
                            extend: 'copyHtml5',
                            exportOptions: {
                                columns: [2, 3, 4, 5, 6, 7]
                            }
                        },
                        {
                            extend: 'excelHtml5',
                            exportOptions: {
                                columns: [2, 3, 4, 5, 6, 7]
                            }
                        },
                        {
                            extend: 'pdfHtml5',
                            exportOptions: {
                                columns: [2, 3, 4, 5, 6, 7]
                            }
                        },
                        /*'colvis'*/
                    ],





                    "columns": [




                        { "data": "id" },
                        { "data": "guncelleyenPersonelId" },
                        { "data": "kodu" },
                        { "data": "adi" },
                        {
                            "data": "satisFiyat",
                            "render": function (satisFiyat) {
                                return '$' + satisFiyat;

                            }

                        },
                        { "data": "stokAdet" },
                        { "data": "renkKod" },
                        { "data": "kategori" },
                        { "data": "altKategori" },



                        {
                            "data": null,
                            "className": "miktar",
                            "render": function (data, type, row) {

                                return '<input id="miktar' + data.id + '" value="" style="width:85px;height:30px;align-items:center" type="number"  class="form-control" placeholder="Miktar" min="0"> ';
                            },
                            "targets": -1
                        },
                        {
                            "data": null,

                            "className": "birim",
                            "render": function (data, type, row) {

                                return '<select id="birim' + data.id + '" style="width:auto;height:30px" name="birim" class="form-control">' +
                                    '<option value ="Adet" >Adet</option >' +
                                    '<option value="Kilogram">Kilogram</option>' +
                                    '<option value="Metre">Metre</option>' +
                                    '<option value="Ton">Ton</option>' +

                                    '</select >';

                            },
                            "targets": -1
                        },
                        {
                            "data": null,
                            "className": "urunekle",
                            "render": function (data, type, row) {

                                return ' <button class="btn btn-success btn-icon-anim btn-circle"><i class="fa fa-plus "></i></button> ';
                            },
                            "targets": -1
                        }


                    ]


                });



                $('#uruntablo tbody').on('click', '.urunekle', function () {
                    var data = uruntablo.row(this).data();
                    var miktar = $('#miktar' + data.id + '').val();
                    var birim = $('#birim' + data.id + '').val();
                    var valid = false;
                    if ((miktar == 0 || undefined)) {




                    }

                    else {
                        valid = true;

                    }

                    urunekle(data, miktar, birim, valid,siparistaslak);




                });



            });
        }
        function urunekle(data, miktar, birim, valid, siparistaslak) {



            if (valid) {
                var std = {


                    SiparisTaslakId:siparistaslak.id,
                    UrunId: data.id,
                    UrunKodu: data.kodu,
                    UrunAdi: data.adi,
                    Miktar: miktar,
                    Birim: birim,
                    SiparisKodu:siparistaslak.siparisKodu,
                    SiparisKodSıra:siparistaslak.id,
                    TaslakOnay:true

                }

                var toplamfiyat = (miktar) * (data.satisFiyat);
                $.ajax({
                    type: "POST",
                    url: "/YeniSiparis/UrunEkle",
                    data: std,
                    dataType: 'json',
                    success: function (durum) {

                        if (durum == "basarili") {

                            Swal.fire({
                                timer: 1500,
                                showConfirmButton: false,
                                icon: 'success',
                                html: true,

                                html:


                                    '<label class=" col-form-label" style="font-size:50px;color:#2c466b">' + data.kodu + '</label><br />' +
                                    '<label class=" col-form-label" style="font-size:50px;color:#c9222a">' + miktar + ' ' + birim + '</label><br />' +
                                    '<label class=" col-form-label" style="font-size:30px;color:#2c466b">Başarılı Bir Şekilde Taslak Siparişe Eklendi..</label><br /><br />'
                                ,

                                confirmButtonColor: '#2c466b'

                                /*footer: '<a href="">Why do I have this issue?</a>'*/
                            })
                            var message = "Ürün Eklendi";
                            $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);

                            if (data.siparistaslak.planlamaRevizeTalepSebebi == null) {
                                SiparisAyrinti(data.siparisTaslak);
                            }
                            else {
                                RevizeAyrinti(data.siparistaslak);
                            }
                            




                        }

                        else if (durum == "urunguncelle") {
                            
                            Swal.fire({
                                title: "<h2 style='color:#c9222a'>ÜRÜN SİPARİŞTE MEVCUT!</h2>",
                                html: true,

                                cancelButtonColor: '#c9222a',
                                cancelButtonText: 'Vazgeç',
                                showCancelButton: true,
                                confirmButtonText: 'Onayla',
                                confirmButtonColor: '#2c466b',
                                showLoaderOnConfirm: true,
                                allowOutsideClick: false,
                                width: '600px',
                                html:



                                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                                    '<label  class="  col-form-label" style="font-size:20px;float:left">Ürün Kodu</label><br />' +
                                    ' <input type="text" style="height:38px;font-size:30px" value="' + data.kodu + '" id="Adi" class="col-sm-8 form-control form-control-center" name="Adi"  disabled ><br />' +
                                    '</div>' +
                                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                                    '<label  class=" col-form-label" style="font-size:20px;float:left">Renk Kodu</label><br />' +
                                    ' <input type="text" style="height:38px;font-size:30px" value="' + data.renkKod + '" id="Adi" class="col-sm-8 form-control form-control-center" name="Adi" disabled ><br />' +
                                    '</div>' +
                                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                                    '<label  class="  col-form-label" style="font-size:20px;float:left">Kategori</label><br />' +
                                    ' <input type="text" style="height:38px;font-size:30px" value="' + data.kategori + '" id="Adi" class="col-sm-8 form-control form-control-center" name="Adi"  disabled><br />' +
                                    '</div>' +
                                    '<div  class="form-group row g-3 align-items-center col-sm-12">' +
                                    '<label  class=" col-form-label" style="font-size:20px;float:left">Fiyat</label><br />' +
                                    ' <input type="text" style="height:38px;font-size:30px" value="' + '$' + data.satisFiyat + '" id="Adi" class="col-sm-8 form-control form-control-center" name="Adi"  disabled ><br />' +
                                    '</div><br />' +
                                    '<label class="  col-form-label" style="font-size:50px;color:#2c466b">' + miktar + ' ' + birim + '</label><br /><br />' +
                                    '<label class="  col-form-label" style="font-size:30px;color:#2c466b">Olarak Güncellenecek Onalıyor Musunuz??</label><br /><br /><br />' +
                                    '<label class="  col-form-label" style="font-size:30px;color:#c9222a">TOPLAM :$' + toplamfiyat + '</label>' +
                                    '</div>',





                                preConfirm: () => {

                                    $.ajax({
                                        type: "POST",
                                        url: "/YeniSiparis/UrunGuncelle",
                                        data: std,
                                        dataType: 'json',
                                        success: function (durum) {

                                            if (durum == "basarili") {

                                                Swal.fire({
                                                    timer: 2000,
                                                    showConfirmButton: false,
                                                    icon: 'success',
                                                    html: true,

                                                    html:


                                                        '<label class=" col-form-label" style="font-size:50px;color:#2c466b">' + data.kodu + '</label><br />' +
                                                        '<label class=" col-form-label" style="font-size:50px;color:#c9222a">' + miktar + ' ' + birim + '</label><br />' +
                                                        '<label class=" col-form-label" style="font-size:30px;color:#2c466b">Olarak Başarılı Bir Şekilde Güncellendi..</label><br /><br />'
                                                    ,

                                                    confirmButtonColor: '#2c466b'

                                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                                })

                                                //var test = "Müşteri güncellendi.";
                                                //$("#müsterihubbtn").trigger('müsterieklesilgüncelle', [test]);
                                                var message = "Ürün Güncellendi.";
                                                $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);
                                                if (data.siparistaslak.planlamaRevizeTalepSebebi == null) {
                                                    SiparisAyrinti(data.siparisTaslak);
                                                }
                                                else {
                                                    RevizeAyrinti(data.siparistaslak);
                                                }

                                            }



                                            else {

                                                Swal.fire({
                                                    icon: 'error',
                                                    title: 'Oops...',
                                                    text: durum,
                                                    confirmButtonColor: '#2c466b',
                                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                                })
                                            }

                                        }


                                    })






                                },
                                allowOutsideClick: () => !Swal.isLoading()
                            })




                        }

                        else {

                            Swal.fire({
                                icon: 'error',
                                title: 'Oops...',
                                text: durum,
                                confirmButtonColor: '#2c466b',
                                /*footer: '<a href="">Why do I have this issue?</a>'*/
                            })
                        }

                    }


                })

            }



        }
        function TaslakSiparisSil(data) {
            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-success btn-round',
                    cancelButton: 'btn btn-danger btn-round',
                },
                focusConfirm: false,
                buttonsStyling: false

            })

            swalWithBootstrapButtons.fire({
                title: 'Emin Misiniz ?',
                text: 'Seçtiğiniz' + ' ' + data.siparisKodu + ' Kodlu Sipariş Silinmek Üzere..',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'EVET',
                cancelButtonText: 'HAYIR',


            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: "/TaslakSiparis/TaslakSiparisSil",
                        data: data,
                        dataType: 'json',
                        success: function (durum) {

                            if (durum == "basarili") {

                                Swal.fire({
                                    icon: 'success',
                                    title: 'Silme İşleminiz Başarılı..',
                                    confirmButtonColor: '#2c466b',
                                    timer: 1500
                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })
                                var message = "Taslak Sipariş Silindi.";
                                $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);


                            }
                            else {

                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: durum,
                                    confirmButtonColor: '#2c466b',
                                    /*footer: '<a href="">Why do I have this issue?</a>'*/
                                })
                            }

                        }


                    })





                }


            })
        }

    

        







    
        $(document).ready(function () {
            $("#planlamaonaylı").click(function () {


                planlamaonaylıliste.load();
            });
            $("#revizetalep").click(function () {

                revizetalepliste.load();


            });
            $("#taslaksiparis").click(function () {

                taslaksiparisliste.load();


            });

        });
    


        var revizetablo;
        var revizetalepliste = {
            load: function () {

                revizetalepliste.tablehtml();
                revizetalepliste.tableload();
            },
            tablehtml: function () {

                var tablehtml = ' <div id="listeload">';
                tablehtml += '<h1 id="yazı" style="color: #2c466b; text-align: center">Revize Talep Edilen  <br />Sipariş Listesi</h1>';
                tablehtml += '<table id="revizetablo" class="table table-border-style wrap">';
                tablehtml += '<thead class="wrap">';
                tablehtml += ' <tr>';
                tablehtml += '<th>Id</th>';
                tablehtml += '<th>GüncelleyenpersonelId</th>';
                tablehtml += '<th>EklenmeTarihi</th>';
                tablehtml += '<th>Aciklama</th>';
                tablehtml += '<th style="text-align:center">PO NUMBER</th>';
                tablehtml += '<th style="text-align:center">Sipariş Kodu</th>';
                tablehtml += '<th style="text-align:center">Miktar</th>';
                tablehtml += '<th style="text-align:center">Fiyat</th>';
                tablehtml += '<th style="text-align:center">Müşteri <br /> Adı-Soyadı</th>';
                tablehtml += '<th style="text-align:center">Oluşturma<br />Tarihi</th>';
                tablehtml += '<th style="text-align:center">Ayrıntı</th>';
                tablehtml += '</tr>';
                tablehtml += '</thead>';
                tablehtml += '</table>';
                tablehtml += '</div>';

                $("#listeload").replaceWith(tablehtml);

            },

            tableload: function () {
                revizetablo;
                $(document).ready(function () {

                    revizetablo = $('#revizetablo').DataTable({

                        /*"dom": 'Blfrtip',*/

                        "responsive": true, "lengthChange": false,
                        "autoWidth": false, "processing": true,
                        "serverSide": false, "select": false,
                        "destroy": true,
                        "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                        "fixedHeader": true,
                        "scrollX": true,
                        "scrollY": true,
                        "order": [[2, "desc"]],

                        "ajax": {
                            "url": "/TaslakSiparis/RevizeTalepListe",
                            "type": "POST"
                        },
                        "columnDefs":
                            [
                                {
                                    "targets": [0, 1, 2, 3],
                                    "visible": false,
                                    "searchable": false,
                                },
                                {
                                    "targets": [2, 3, 4, 5, 6, 7, 8, 9],
                                    "className": 'dt-body-center'

                                },



                            ],







                        "columns": [




                            { "data": "id" },
                            { "data": "guncelleyenPersonelId" },
                            { "data": "eklenmeTarihi" },
                            { "data": "aciklama" },
                            { "data": "poNumber" },
                            { "data": "siparisKodu" },
                            { "data": "miktar" },
                            {
                                "data": "fiyat",
                                "render": function (fiyat) {
                                    return '$' + fiyat;

                                }

                            },
                            { "data": "musteriAdiSoyadi" },
                            { "data": "olusturmaTarihi" },






                            {
                                "data": null,
                                "className": "revizeayrinti",
                                "render": function (data, type, row) {

                                    return '  <button  class="btn btn-primary btn-icon-anim btn-circle"><i class="fa fa-info-circle "></i></button>  ';
                                },
                                "targets": -1
                            }
                           


                        ],


                    });
                    $('#revizetablo tbody').on('click', '.revizeayrinti', function () {
                        siparistaslak = revizetablo.row(this).data();
                        RevizeAyrinti(siparistaslak);




                    });




                });






            },





        };
        var taslaksiparisliste = {
            load: function () {
                taslaksiparisliste.tablehtml();
                taslaksiparisliste.tableload();
            },
            tablehtml: function () {
                /* $('#listeload').remove();*/
                var tablehtml = ' <div id="listeload">';
                tablehtml += '<h1 id="yazı" style="color: #2c466b; text-align: center">Taslak  <br />Sipariş Listesi</h1>';
                tablehtml += '<table id="taslaksiparistablosu" class="table table-border-style wrap">';
                tablehtml += '<thead class="wrap">';
                tablehtml += ' <tr>';
                tablehtml += '<th>Id</th>';
                tablehtml += '<th>GüncelleyenpersonelId</th>';
                tablehtml += '<th>EklenmeTarihi</th>';
                tablehtml += '<th>Aciklama</th>';
                tablehtml += '<th style="text-align:center">PO NUMBER</th>';
                tablehtml += '<th style="text-align:center">Sipariş Kodu</th>';
                tablehtml += '<th style="text-align:center">Miktar</th>';
                tablehtml += '<th style="text-align:center">Fiyat</th>';
                tablehtml += '<th style="text-align:center">Müşteri <br /> Adı-Soyadı</th>';
                tablehtml += '<th style="text-align:center">Oluşturma<br />Tarihi</th>';
                tablehtml += '<th style="text-align:center">Ayrıntı</th>';
                tablehtml += '<th style="text-align:center">Onay</th>';
                tablehtml += '</tr>';
                tablehtml += '</thead>';
                tablehtml += '</table>';
                tablehtml += '</div>';

                $("#listeload").replaceWith(tablehtml);

            },

            tableload: function () {
                var taslaksiparistablosu;
                $(document).ready(function () {

                    taslaksiparistablosu = $('#taslaksiparistablosu').DataTable({

                        /*"dom": 'Blfrtip',*/

                        "responsive": true, "lengthChange": false,
                        "autoWidth": false, "processing": true,
                        "serverSide": false, "select": false,
                        "destroy": true,
                        "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                        "fixedHeader": true,
                        "scrollX": true,
                        "scrollY": true,
                        "order": [[2, "desc"]],

                        "ajax": {
                            "url": "/TaslakSiparis/TaslakSiparisListe",
                            "type": "GET"
                        },
                        "columnDefs":
                            [
                                {
                                    "targets": [0, 1, 2, 3],
                                    "visible": false,
                                    "searchable": false,
                                },
                                {
                                    "targets": [2, 3, 4, 5, 6, 7, 8, 9],
                                    "className": 'dt-body-center'

                                },



                            ],







                        "columns": [




                            { "data": "id" },
                            { "data": "guncelleyenPersonelId" },
                            { "data": "eklenmeTarihi" },
                            { "data": "aciklama" },
                            { "data": "poNumber" },
                            { "data": "siparisKodu" },
                            { "data": "miktar" },
                            {
                                "data": "fiyat",
                                "render": function (fiyat) {
                                    return '$' + fiyat;

                                }

                            },
                            { "data": "musteriAdiSoyadi" },
                            { "data": "olusturmaTarihi" },






                            {
                                "data": null,
                                "className": "ayrinti",
                                "render": function (data, type, row) {

                                    return '  <button  class="btn btn-primary btn-icon-anim btn-circle"><i class="fa fa-info-circle "></i></button>  ';
                                },
                                "targets": -1
                            },
                            {
                                "data": null,
                                "className": "sil",
                                "render": function (data, type, row) {

                                    return ' <button class="btn btn-danger btn-icon-anim btn-circle"><i class="fa fa-trash "></i></button> ';
                                },
                                "targets": -1
                            }


                        ],


                    });
                    $('#taslaksiparistablosu tbody').on('click', '.ayrinti', function () {
                        siparistaslak = taslaksiparistablosu.row(this).data();
                        SiparisAyrinti(siparistaslak);
                        



                    });
                    $('#taslaksiparisler tbody').on('click', '.sil', function () {
                        var data = taslaksiparistablosu.row(this).data();


                        TaslakSiparisSil(data);

                    });



                });
               





            },


        };
        function SiparisAyrinti(siparistaslak) {
            $.ajax({
                type: "POST",
                url: "/TaslakSiparis/SiparisUrunListe",
                data: siparistaslak,
                dataType: 'json',
                success: function (data) {


                    siparisayrinti.planlamaonaysızmodal(siparistaslak);
                    siparisayrinti.eklenenürünlerigetir(data);


                }


            });
        }
        function RevizeAyrinti(siparistaslak) {
            $.ajax({
                type: "POST",
                url: "/TaslakSiparis/SiparisUrunListe",
                data: siparistaslak,
                dataType: 'json',
                success: function (data) {


                    revizeayrinti.revizemodal(siparistaslak);
                    revizeayrinti.revizmodaluruntablo(data);


                }


            });
        }
        var revizeayrinti = {

            revizmodaluruntablo: function (data) {

                var revizeuruntablo = $('#revizeuruntablo').DataTable({

                    /*"dom": 'Blfrtip',*/

                    "responsive": true, "lengthChange": false,
                    "autoWidth": false, "processing": true,
                    "serverSide": false, "select": false,
                    "destroy": true,
                    "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                    "fixedHeader": true,
                    "scrollX": true,
                    "scrollY": true,

                    "data": data,
                    "columnDefs":
                        [
                            {
                                "targets": [0, 1, 2, 5, 6, 12, 13],
                                "visible": false,
                                "searchable": false,
                            },
                            {
                                "targets": [3, 4, 7, 8, 9, 10, 11, 14],
                                "className": 'dt-center'

                            },





                        ],







                    "columns": [




                        { "data": "id" },
                        { "data": "guncelleyenPersonelId" },

                        { "data": "urunId" },
                        { "data": "kodu" },
                        { "data": "adi" },
                        {
                            "data": "satisFiyat",
                            "render": function (satisFiyat) {
                                return '$' + satisFiyat;

                            }

                        },
                        { "data": "stokAdet" },
                        { "data": "renkKod" },
                        { "data": "kategori" },
                        { "data": "altKategori" },
                        { "data": "miktar" },
                        { "data": "birim" },
                        { "data": "siparisKodu" },
                        { "data": "siparisTaslakId" },


                        {
                            "data": null,
                            "className": "düzenle",
                            "render": function (data, type, row) {

                                return '<button class="btn btn-primary btn-icon-anim btn-circle"><i class="fa fa-edit "></i></button> ';
                            },
                            "targets": -1
                        },
                        {
                            "data": null,
                            "className": "sil",
                            "render": function (data, type, row) {

                                return ' <button class="btn btn-danger btn-icon-anim btn-circle"><i class="fa fa-trash "></i></button> ';
                            },
                            "targets": -1
                        }


                    ]


                });
                $('#revizeuruntablo tbody').on('click', '.düzenle', function () {
                    var data = revizeuruntablo.row(this).data();


                    SiparisOnayUrunGunncelle(data);

                });
                $('#revizeuruntablo tbody').on('click', '.sil', function () {
                    var data = revizeuruntablo.row(this).data();


                    SiparisOnayUrunSil(data);

                });
            },
            revizemodal: function (siparistaslak) {

                var poNumber;
                var aciklama;
                if (siparistaslak.poNumber == undefined || siparistaslak.poNumber == null) {
                    poNumber = "";
                }
                else {
                    poNumber = siparistaslak.poNumber;
                };
                if (siparistaslak.aciklama == undefined || siparistaslak.aciklama == null) {
                    aciklama = "";

                }
                else {
                    aciklama = siparistaslak.aciklama;
                };





                Swal.fire({
                    title: '<i  class="fa fa-info fa-3x" style="color:#3cb878">' +
                        '<h2 style="color:#2c466b">SİPARİŞ AYRINTI</h2>',
                    allowOutsideClick: false,
                    html: true,


                    cancelButtonColor: '#c9222a',
                    cancelButtonText: 'Vazgeç',
                    showCancelButton: true,
                    confirmButtonText: 'Onayla',
                    confirmButtonColor: '#2c466b',
                    showLoaderOnConfirm: true,




                    width: '1550px',
                    html:

                        '<div  class="col-sm-12">' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Taslak Sipariş Kodu :&nbsp&nbsp</label>' +
                        '<label class="col-form-label" style="font-size:25px;color:#c9222a">' + siparistaslak.siparisKodu + '</label><br /><br />' +
                        '<label class="col-form-label" style="font-size:20px;color:#2c466b">PO NUMBER &nbsp&nbsp</label>' +

                        '<input id="ponumber" value="' + poNumber + '" class="col-form-control" style="font-size:20px;color:#c9222a"></input>' +

                        '</div>' +



                        '<div  class="col-sm-12">' +


                        '<table id="revizeuruntablo" class="table table-border-style wrap">' +
                        ' <thead class="wrap">' +
                        '<tr>' +
                        '<th>Id</th>' +
                        '<th>GüncelleyenpersonelId</th>' +
                        '<th>ÜrünId</th>' +
                        '<th style="text-align:center">Ürün Kodu</th>' +
                        '<th style="text-align:center">Ürün Adı</th>' +
                        '<th style="text-align:center">Satış Fiyat</th>' +
                        '<th style="text-align:center">Stok Adet</th>' +
                        '<th style="text-align:center">Renk Kodu</th>' +
                        '<th style="text-align:center">Kategori</th>' +
                        '<th style="text-align:center">Alt <br /> Kategori</th>' +
                        '<th style="align-items:center">Miktar</th>' +
                        '<th style="align-items:center">Birim</th>' +
                        '<th style="align-items:center">SiparisKodu</th>' +
                        '<th style="align-items:center">SiparisTaslakId</th>' +
                        '<th style="align-items:center">Düzenle</th>' +
                        '<th style="align-items:center">Sil</th>' +

                        '</tr>' +
                        '</thead>' +
                        '</table>' +
                        '</div><br /><br />' +
                        '<div  class="input-group row g-3 align-items-center col-sm-12">' +
                        '<div  class="col-sm-6">' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Açıklama</label><br />' +
                        '<textarea id="aciklama" style="height:80px" rows="8" cols="55" class="col-sm-12 form-control">' + aciklama + '</textarea><br /><br /><br /><br /><br />' +
                        '<label class="col-form-label" style="font-size:30px;color:#c9222a">' + siparistaslak.planlamaRevizeTalepSebebi + '</label><br />' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Revize Talep Açıklama</label><br />' +
                        '<textarea style="height:80px" rows="8" cols="55" class="col-sm-12 form-control" readonly>' + siparistaslak.planlamaRevizeAciklama + '</textarea>' +

                        '</div><br /><br />' +
                        '<div  class="col-sm-6">' +
                        '<button  onclick="SiparisOnayUrunEkle(siparistaslak)" class="btn btn-success btn-anim"><i class="icon-rocket"></i><span class="btn-text">Ürün Ekle</span></button><br /><br />' +
                        
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Toplam Adet :</label>' +
                        '<label class="col-form-label" style="font-size:45px;color:#c9222a">' + ' ' + '' + siparistaslak.miktar + ' </label><br />' +
                        '<label class="col-form-label" style="font-size:25px;color:#2c466b">Toplam Fiyat :</label>' +
                        '<label class="col-form-label" style="font-size:45px;color:#c9222a">' + ' ' + '$' + siparistaslak.fiyat + ' </label>' +


                        '</div>' +
                        '</div><br />',








                    preConfirm: () => {
                        $.ajax({
                            type: "POST",
                            url: "/TaslakSiparis/RevizeResponse",
                            data:siparistaslak,
                            dataType: 'json',
                            success: function (data) {

                                if (data=="basarili") {
                                    Swal.mixin({
                                        toast: true,
                                        position: 'top',
                                        iconColor: 'white',
                                        customClass: {
                                            popup: 'colored-toast'
                                        },
                                        showConfirmButton: false,
                                        timer: 3500,
                                        timerProgressBar: true,

                                    }).fire({
                                        icon: 'success',
                                        title:'Yaptığınız tüm revizeler başarılı bir şekilde Üretim Planlama birimine İletildi.',
                                        width: '500px'

                                    })
                                    var message = "Revize Talebi Cevaplandı.";
                                    $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);
                                    BadgesGuncelle();
                                } else {
                                    Swal.mixin({
                                        toast: true,
                                        position: 'top',
                                        iconColor: 'white',
                                        customClass: {
                                            popup: 'colored-toast'
                                        },
                                        showConfirmButton: false,
                                        timer: 4000,
                                        timerProgressBar: true,

                                    }).fire({
                                        icon: 'error',
                                        title: data,
                                        width: '500px'

                                    })
                                }
                                

                            }


                        })

                    },
                    allowOutsideClick: () => !Swal.isLoading()
                })

            }
        };
        $(document).ready(function () {
            BadgesGuncelle();

        });
        function BadgesGuncelle() {
            $.ajax({
                type: "POST",
                url: "/TaslakSiparis/BadgesGuncelle",
                dataType: 'json',
                success: function (data) {

                    document.getElementById('planlamaonaybadge').innerHTML = data.planlamabadge;
                    document.getElementById('taslaksiparisbadge').innerHTML = data.taslakbadge;
                    document.getElementById('revizetalepbadge').innerHTML = data.revizebagde;

                }


            })
        }



    </script>
    <script>
        var planlamaonaylıtablo;
        var planlamaonaylıliste = {
            load: function () {
                planlamaonaylıliste.tablehtml();
                planlamaonaylıliste.tableload();
            },
            tablehtml: function () {
                /* $('#listeload').remove();*/
                var tablehtml = ' <div id="listeload">';
                tablehtml += '<h1 id="yazı" style="color: #2c466b; text-align: center">Planlama Onaylı  <br />Sipariş Listesi</h1>';
                tablehtml += '<table id="planlamaonaylıtablo" class="table table-border-style wrap">';
                tablehtml += '<thead class="wrap">';
                tablehtml += ' <tr>';
                tablehtml += '<th>Id</th>';
                tablehtml += '<th>GüncelleyenpersonelId</th>';
                tablehtml += '<th>EklenmeTarihi</th>';
                tablehtml += '<th>Aciklama</th>';
                tablehtml += '<th style="text-align:center">PO NUMBER</th>';
                tablehtml += '<th style="text-align:center">Sipariş Kodu</th>';
                tablehtml += '<th style="text-align:center">Miktar</th>';
                tablehtml += '<th style="text-align:center">Fiyat</th>';
                tablehtml += '<th style="text-align:center">Müşteri <br /> Adı-Soyadı</th>';
                tablehtml += '<th style="text-align:center">Oluşturma<br />Tarihi</th>';
                tablehtml += '<th style="text-align:center">RevizeDurum</th>';
                tablehtml += '<th style="text-align:center">Ayrıntı</th>';

                tablehtml += '</tr>';
                tablehtml += '</thead>';
                tablehtml += '</table>';
                tablehtml += '</div>';

                $("#listeload").replaceWith(tablehtml);

            },

            tableload: function () {
                
                $(document).ready(function () {

                    planlamaonaylıtablo = $('#planlamaonaylıtablo').DataTable({

                        /*"dom": 'Blfrtip',*/

                        "responsive": true, "lengthChange": false,
                        "autoWidth": false, "processing": true,
                        "serverSide": false, "select": false,
                        "destroy": true,
                        "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                        "fixedHeader": true,
                        "scrollX": true,
                        "scrollY": true,
                        "order": [[2, "desc"]],

                        "ajax": {
                            "url": "/TaslakSiparis/PlanlamaOnaylıListe",
                            "type": "POST"
                        },
                        "columnDefs":
                            [
                                {
                                    "targets": [0, 1, 2, 3,10],
                                    "visible": false,
                                    "searchable": false,
                                },
                                {
                                    "targets": [2, 3, 4, 5, 6, 7, 8, 9,11],
                                    "className": 'dt-body-center'

                                },



                            ],







                        "columns": [




                            { "data": "id" },
                            { "data": "guncelleyenPersonelId" },
                            { "data": "eklenmeTarihi" },
                            { "data": "aciklama" },
                            { "data": "poNumber" },
                            { "data": "siparisKodu" },
                            { "data": "miktar" },
                            {
                                "data": "fiyat",
                                "render": function (fiyat) {
                                    return '$' + fiyat;

                                }

                            },
                            { "data": "musteriAdiSoyadi" },
                            { "data": "olusturmaTarihi" },
                            { "data": "kullaniciRevizeTalepSebebi" },






                            {
                                "data": null,
                                "className": "ayrinti",
                                "render": function (data, type, row) {
                                    
                                    return '  <button id="' + data.siparisKodu + '" class="btn btn-primary btn-icon-anim btn-circle"><i class="fa fa-info-circle"></i></button>  ';
                                },
                                "targets": -1
                            }
                           


                        ],
                        "rowCallback": function (row, data, index) {
                            




                            if (data["kullaniciRevizeTalepSebebi"] != null ) {
                                var interval = 0;

                                setInterval(function () {
                                    interval++;
                                    if (interval % 2 == 1) {
                                        $('td', row).css('color', '#c9222a');


                                    }
                                    if (interval == 2) {

                                        $('td', row).css('color', '#2c466b');

                                        interval = 0;
                                    }


                                }, 2000);


                            }
                        }


                    });
                    $('#planlamaonaylıtablo tbody').on('click', '.ayrinti', function () {

                        siparistaslak = planlamaonaylıtablo.row(this).data();
                        if (siparistaslak.kullaniciRevizeTalepSebebi==null) {
                            PlanlamaSiparisAyrinti.PlanlamaOnaylıModel(siparistaslak);
                            PlanlamaSiparisAyrinti.UrunListe(siparistaslak);
                        }
                        else {
                            Swal.mixin({
                                toast: true,
                                position: 'top',
                                iconColor: 'white',
                                customClass: {
                                    popup: 'colored-toast'
                                },
                                showConfirmButton: false,
                                timer: 4500,
                                timerProgressBar: true,

                            }).fire({
                                icon: 'error',
                                title: 'Bu sipariş için revize talep edilmiştir.Lütfen Üretim Planlama birimi ile irtibata geçiniz..',
                                width: '500px'

                            })


                        }
                        

                    });
                    



                });






            },





        };

        var PlanlamaSiparisAyrinti = {
            PlanlamaOnaylıModel: function (siparistaslak) {
                PlanlamaOnaylıModel(siparistaslak);
                

            },
            UrunListe: function (siparisTaslak) {
                $.ajax({
                    type: "POST",
                    url: "/TaslakSiparis/SiparisUrunListe",
                    data: siparistaslak,
                    dataType: 'json',
                    success: function (data) {



                        PlanlamaModelUrunListe(data);


                    }


                });
            }
        }
        function PlanlamaOnaylıModel(siparisTaslak) {
            var poNumber;
            var aciklama;
            if (siparisTaslak.poNumber == undefined || siparisTaslak.poNumber == null) {
                poNumber = "";
            }
            else {
                poNumber = siparisTaslak.poNumber;
            };
            if (siparisTaslak.aciklama == undefined || siparisTaslak.aciklama == null) {
                aciklama = "";

            }
            else {
                aciklama = siparisTaslak.aciklama;
            };





            Swal.fire({
                title: '<i  class="fa fa-check-square fa-3x" style="color:#3cb878">' +
                    '<h2 style="color:#2c466b">TASLAK SİPARİŞ</h2>',
                allowOutsideClick: false,
                html: true,
                denyButtonColor: '#2c466b',
                showDenyButton: true,
                cancelButtonColor: '#c9222a',
                denyButtonText: 'Revize',
                cancelButtonText: 'İptal',
                showCancelButton: true,
                confirmButtonText: 'Onayla',
                confirmButtonColor: '#3cb878',





                width: '1450px',
                html:

                    '<div  class="col-sm-12">' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Taslak Sipariş Kodu :&nbsp&nbsp</label>' +
                    '<label class="col-form-label" style="font-size:25px;color:#c9222a">' + siparisTaslak.siparisKodu + '</label><br /><br />' +
                    '<label class="col-form-label" style="font-size:20px;color:#2c466b">PO NUMBER &nbsp&nbsp</label>' +

                    '<input id="ponumber" value="' + poNumber + '" class="col-form-control" style="font-size:20px;color:#c9222a" readonly ></input>' +

                    '</div>' +




                    '<div  class="col-sm-12">' +


                    '<table id="planlamasiparisuruntablo" class="table table-border-style wrap">' +
                    ' <thead class="wrap">' +
                    '<tr>' +
                    '<th>Id</th>' +
                    '<th>GüncelleyenpersonelId</th>' +
                    '<th>ÜrünId</th>' +
                    '<th style="text-align:center">Ürün Kodu</th>' +
                    '<th style="text-align:center">Ürün Adı</th>' +
                    '<th style="text-align:center">Satış Fiyat</th>' +
                    '<th style="text-align:center">Stok Adet</th>' +
                    '<th style="text-align:center">Renk Kodu</th>' +
                    '<th style="text-align:center">Kategori</th>' +
                    '<th style="text-align:center">Alt <br /> Kategori</th>' +
                    '<th style="align-items:center">Miktar</th>' +
                    '<th style="align-items:center">Birim</th>' +
                    '<th style="align-items:center">SiparisKodu</th>' +
                    '<th style="align-items:center">SiparisTaslakId</th>' +


                    '</tr>' +
                    '</thead>' +
                    '</table>' +
                    '</div><br /><br />' +
                    '<div  class="input-group row g-3 align-items-center col-sm-12">' +
                    '<div  class="col-sm-6">' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Açıklama</label><br />' +
                    '<textarea id="aciklama" style="height:150px;width:605px" rows="8" cols="55" class="col-sm-12 form-control" readonly >' + aciklama + '</textarea>' +

                    '</div><br /><br />' +
                    '<div  class="col-sm-6">' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Toplam Adet :</label>' +
                    '<label class="col-form-label" style="font-size:45px;color:#c9222a">' + ' ' + '' + siparisTaslak.miktar + ' </label><br />' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Toplam Fiyat :</label>' +
                    '<label class="col-form-label" style="font-size:45px;color:#c9222a">' + ' ' + '$' + siparisTaslak.fiyat + ' </label>' +


                    '</div>' +
                    '</div><br />',



            }).then((result) => {
                if (result.isConfirmed) {

                    MusteriOnay(siparisTaslak);

                } else if (result.isDenied) {

                    KullaniciRevizeTalep(siparisTaslak)
                    PlanlamaSiparisAyrinti.UrunListe(siparisTaslak);
                }
            })
        }
        function PlanlamaModelUrunListe(data) {
            var planlamasiparisuruntablo = $('#planlamasiparisuruntablo').DataTable({

                /*"dom": 'Blfrtip',*/

                "responsive": true, "lengthChange": false,
                "autoWidth": false, "processing": true,
                "serverSide": false, "select": false,
                "destroy": true,
                "lengthMenu": [[5, 10, 30, -1], [5, 10, 30, "All"]],
                "fixedHeader": true,
                "scrollX": true,
                "scrollY": true,

                "data":data,
                "columnDefs":
                    [
                        {
                            "targets": [0, 1, 2, 5, 6, 12, 13],
                            "visible": false,
                            "searchable": false,
                        },
                        {
                            "targets": [3, 4, 7, 8, 9, 10, 11],
                            "className": 'dt-center'

                        },





                    ],







                "columns": [




                    { "data": "id" },
                    { "data": "guncelleyenPersonelId" },

                    { "data": "urunId" },
                    { "data": "kodu" },
                    { "data": "adi" },
                    {
                        "data": "satisFiyat",
                        "render": function (satisFiyat) {
                            return '$' + satisFiyat;

                        }

                    },
                    { "data": "stokAdet" },
                    { "data": "renkKod" },
                    { "data": "kategori" },
                    { "data": "altKategori" },
                    { "data": "miktar" },
                    { "data": "birim" },
                    { "data": "siparisKodu" },
                    { "data": "siparisTaslakId" },





                ]


            });

        }
        function MusteriOnay(siparistaslak) {

            $.ajax({
                type: "POST",
                url: "/Planlama/PlanlamaOnay",
                data: siparistaslak,
                dataType: 'json',
                success: function (durum) {

                    if (durum == "basarili") {




                        Swal.mixin({
                            toast: true,
                            position: 'top',
                            iconColor: 'white',
                            customClass: {
                                popup: 'colored-toast'
                            },
                            showConfirmButton: false,
                            timer: 2500,
                            timerProgressBar: true,

                        }).fire({
                            icon: 'success',
                            title: 'Planlama Onayı Başarılı Bir Şekilde Verildi',
                            width: '500px'

                        })
                        var message = "Siparis Taslak Onaylandı.";
                        $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);


                    }



                    else {

                        Swal.mixin({
                            toast: true,
                            position: 'top',
                            iconColor: 'white',
                            customClass: {
                                popup: 'colored-toast'
                            },
                            showConfirmButton: false,
                            timer: 2500,
                            timerProgressBar: true,

                        }).fire({
                            icon: 'error',
                            title: data,
                            width: '500px'

                        })
                    }

                }


            })

        };
        function KullaniciRevizeTalep(siparistaslak) {
            var poNumber;
            var aciklama;
            if (siparistaslak.poNumber == undefined || siparistaslak.poNumber == null) {
                poNumber = "";
            }
            else {
                poNumber = siparistaslak.poNumber;
            };
            if (siparistaslak.aciklama == undefined || siparistaslak.aciklama == null) {
                aciklama = "";

            }
            else {
                aciklama = siparistaslak.aciklama;
            };
            Swal.fire({
                title: '<i  class="fa fa-ban fa-3x" style="color:#c9222a">' +
                    '<h2 style="color:#2c466b">TASLAK SİPARİŞ REVİZE TALEBİ</h2>',
                allowOutsideClick: false,
                html: true,


                cancelButtonColor: '#c9222a',

                cancelButtonText: 'İptal',
                showCancelButton: true,
                confirmButtonText: 'Onayla',
                confirmButtonColor: '#3cb878',
                showLoaderOnConfirm: true,




                width: '1450px',
                html:

                    '<div  class="col-sm-12">' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Taslak Sipariş Kodu :&nbsp&nbsp</label>' +
                    '<label class="col-form-label" style="font-size:25px;color:#c9222a">' + siparistaslak.siparisKodu + '</label><br /><br />' +
                    '<label class="col-form-label" style="font-size:20px;color:#2c466b">PO NUMBER &nbsp&nbsp</label>' +

                    '<input id="ponumber" value="' + poNumber + '" class="col-form-control" style="font-size:20px;color:#c9222a" readonly ></input>' +

                    '</div>' +



                    '<div  class="col-sm-12">' +


                    '<table id="planlamasiparisuruntablo" class="table table-border-style wrap">' +
                    ' <thead class="wrap">' +
                    '<tr>' +
                    '<th>Id</th>' +
                    '<th>GüncelleyenpersonelId</th>' +
                    '<th>ÜrünId</th>' +
                    '<th style="text-align:center">Ürün Kodu</th>' +
                    '<th style="text-align:center">Ürün Adı</th>' +
                    '<th style="text-align:center">Satış Fiyat</th>' +
                    '<th style="text-align:center">Stok Adet</th>' +
                    '<th style="text-align:center">Renk Kodu</th>' +
                    '<th style="text-align:center">Kategori</th>' +
                    '<th style="text-align:center">Alt <br /> Kategori</th>' +
                    '<th style="align-items:center">Miktar</th>' +
                    '<th style="align-items:center">Birim</th>' +
                    '<th style="align-items:center">SiparisKodu</th>' +
                    '<th style="align-items:center">SiparisTaslakId</th>' +


                    '</tr>' +
                    '</thead>' +
                    '</table>' +
                    '</div><br /><br />' +
                    '<div  class="input-group row g-3 align-items-center col-sm-12">' +
                    '<div  class="col-sm-6">' +
                    '<label class="col-form-label" style="font-size:25px;color:#2c466b">Açıklama</label><br />' +
                    '<textarea id="aciklama" style="height:150px;width:605px" rows="8" cols="55" class="col-sm-12 form-control" readonly>' + aciklama + '</textarea>' +

                    '</div>' +
                    '<div  class="col-sm-6">' +
                    '<label class="col-form-label" style="font-size:25px;color:#c9222a">Revize Talep Sebebi</label>' +
                    '<select id="kullanicirevizetalepsebebi" class="form-control">' +
                    '    <option>Müşterinin Ürün Değişikliği</option>' +
                    '    <option>Ürün Adet Değişikliği</option>' +
                    '    <option>Sipariş İptali</option>' +
                    '    <option>Diğer Nedenler..</option>' +
                    '</select><br />' +
                    '<label class="col-form-label" style="font-size:25px;color:#c9222a">Revize Talep Açıklama</label><br />' +
                    '<textarea id="kullanicirevizeaciklama" style="height:80px" rows="8" cols="55" class="col-sm-12 form-control" ></textarea>' +


                    '</div>' +
                    '</div><br />',



            }).then((result) => {
                siparistaslak.kullaniciRevizeTalepSebebi = $("#kullanicirevizetalepsebebi").val();
                siparistaslak.kullaniciRevizeAciklama = $("#kullanicirevizeaciklama").val();

                if (result.isConfirmed) {
                    
                    $.ajax({
                        type: "POST",
                        url: "/TaslakSiparis/KullanıcıRevize",
                        data:siparistaslak,
                        dataType: 'json',
                        success: function (data) {

                            if (data == "basarili") {


                                Swal.mixin({
                                    toast: true,
                                    position: 'top',
                                    iconColor: 'white',
                                    customClass: {
                                        popup: 'colored-toast'
                                    },
                                    showConfirmButton: false,
                                    timer: 2500,
                                    timerProgressBar: true,

                                }).fire({
                                    icon: 'success',
                                    title: 'Revize Talebi Başarılı',
                                    width: '500px'

                                })
                                var message = "Siparis Taslak Onaylandı.";
                                $("#SiparisTaslakHubBtn").trigger('siparistaslakeklesilgüncelle', [message]);
                                
                                $("#planlamaonaylı").trigger('click');

                            }



                            else {

                                Swal.mixin({
                                    toast: true,
                                    position: 'top',
                                    iconColor: 'white',
                                    customClass: {
                                        popup: 'colored-toast'
                                    },
                                    showConfirmButton: false,
                                    timer: 4500,
                                    timerProgressBar: true,

                                }).fire({
                                    icon: 'error',
                                    title: data,
                                    width: '500px'

                                })
                            }

                        }


                    })









                }
            })
        };
    </script>
    <script>
        $(document).ready(function () {

            const conn = new signalR.HubConnectionBuilder().withUrl("/SiparisTaslakHub").build();
            conn.start();

            $("#SiparisTaslakHubBtn").on('siparistaslakeklesilgüncelle', function (event, message) {



                conn.invoke("SiparisTaslakTabloReload", message);



            });
            conn.on("siparistaslakeklesilgüncelle", message => {
                BadgesGuncelle();
                taslaksiparisler.ajax.reload();
                revizetablo.ajax.reload();
                planlamatablo.ajax.reload();
                
               
            });
           






            

        });
    </script>

</body>
</html>